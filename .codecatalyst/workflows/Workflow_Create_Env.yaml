Name: Create_CF_Stack_Workflow
SchemaVersion: "1.0"

Triggers:
  - Type: Manual

Actions:
  CreateStack:
    Identifier: aws/build@v1.0.0

    Inputs:
      Sources:
        - WorkflowSource

    Configuration:
      Steps:
        - Run: |
            echo "Creating CloudFormation stack with the provided parameters..."

            aws cloudformation create-stack \
              --stack-name flotorch-stack \
              --template-url https://flotorch-public.s3.us-east-1.amazonaws.com/templates/master-template.yaml \
              --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM \
              --parameters \
                  ParameterKey=ProjectName,ParameterValue=${{ WorkflowSource.PROJECT_NAME }} \
                  ParameterKey=TableSuffix,ParameterValue=${{ WorkflowSource.TABLE_SUFFIX }} \
                  ParameterKey=ClientName,ParameterValue=${{ WorkflowSource.CLIENT_NAME }} \
                  ParameterKey=OpenSearchAdminUser,ParameterValue=${{ WorkflowSource.OPENSEARCH_ADMIN_USER }} \
                  ParameterKey=OpenSearchAdminPassword,ParameterValue=${{ WorkflowSource.OPENSEARCH_ADMIN_PASSWORD }} \
                  ParameterKey=NginxAuthPassword,ParameterValue=${{ WorkflowSource.NGINX_AUTH_PASSWORD }}

            echo "CloudFormation stack creation initiated."

      Container:
        Registry: CODECATALYST
        Image: CodeCatalystLinux_x86_64:2024_03

    Compute:
      Type: EC2

    Environment:
      Name: Dev
